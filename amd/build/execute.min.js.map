{"version":3,"sources":["../src/execute.js"],"names":["define","$","str","ModalFactory","ModalEvents","init","executor","courseid","sections","command","returnurl","param","each","click","indexOf","substr","console","log","ajax","url","type","data","success","result","window","location","error","e","execute","on","val","attr","confirm","nosectioncheck","push","length","create","types","CANCEL","title","body","then","modal","show","JSON","stringify","SAVE_CANCEL","done","getRoot","save","preventDefault","checkAll","uncheckAll","checkSelection","event","altKey","parent","find","self","theVal","initFunctions","document","ready"],"mappings":"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","sourcesContent":["define(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events'], function($, str, ModalFactory, ModalEvents) {\n    /* eslint no-console: [\"error\", { allow: [\"log\", \"warn\", \"error\"] }] */\n    return {\n        init: function() {\n\n// ---------------------------------------------------------------------------------------------------------------------\n            var executor = function(courseid, sections, command, returnurl) {\n                var param = '';\n\n                // Check all sections\n                if (command == 'check_all') {\n                    $('input[class=\"section\"]:not(:checked)').each(function() {\n                        $(this).click();\n                    });\n                } else\n\n                // Uncheck all sections\n                if (command == 'uncheck_all') {\n                    $('input[class=\"section\"]:checked').each(function() {\n                        $(this).click();\n                    });\n                } else\n                {\n                    // Check for tab moves and extract the tab nr\n                    if (command.indexOf('move2tab') > -1) {\n                        param = command.substr(8);\n                        command = 'move2tab';\n                    }\n                    // Nnow execute the command with the selected sections\n                    console.log('courseID = ' + courseid);\n                    console.log('command = ' + command);\n                    console.log('param = ' + param);\n                    $.ajax({\n                        url: \"execute.php\",\n                        type: \"POST\",\n                        data: {'courseid': courseid, 'command': command, 'param': param, 'sections': sections},\n                        success: function(result) {\n                            if(result !== '') {\n                                console.log('Execution result:\\n' + result);\n                            } else {\n                                console.log('Execution failed!\\n');\n                            }\n                            window.location = returnurl;\n                        },\n                        error: function(e) {\n                                console.log(e);\n                        }\n                    });\n                }\n\n            };\n\n// ---------------------------------------------------------------------------------------------------------------------\n            var execute = function() {\n                $(\".dropdown-item\").on('click', function() {\n\n                    // Get the course ID\n                    var courseid = $('#courseid').val();\n                    var returnurl = $('#returnurl').val();\n                    var command = $(this).attr('value');\n                    var confirm = $(this).attr('confirm_txt');\n                    var nosectioncheck = $(this).attr('no_section_check'); // If set do not check for selected sections\n                    console.log('course ID = ' + courseid);\n                    console.log('command = ' + command);\n                    console.log('confirmation = ' + confirm);\n\n                    // Get the selected sections\n                    var sections = [];\n                    $('input[class=\"section\"]:checked').each(function() {\n                        sections.push($(this).val());\n                        console.log('=> section checked: '+$(this).val());\n                    });\n                    if (sections.length === 0 && nosectioncheck !== '1') {\n                        ModalFactory.create({\n                            //type: ModalFactory.types.SAVE_CANCEL,\n                            type: ModalFactory.types.CANCEL,\n                            title: 'No Topic selected',\n                            body: 'Please select at least one topic for this action.',\n                        })\n                            .then(function(modal) {\n//                                modal.setSaveButtonText('OK');\n                                modal.show();\n                            });\n                    } else {\n                        sections = JSON.stringify(sections);\n                        console.log(sections);\n\n                        // Get the selected command\n                        if(confirm === '' || confirm === false) { // No confirmation needed - do it now!\n                            executor(courseid, sections, command, returnurl);\n                        } else {\n                            ModalFactory.create({\n                                title: 'Please confirm',\n                                body: '<p>'+confirm+'</p>',\n                                type: ModalFactory.types.SAVE_CANCEL,\n                            })\n                            .done(function(modal) {\n                                modal.show();\n                                console.log(modal);\n                                modal.getRoot().on(ModalEvents.save, function(e) {\n                                    // When modal \"Save\" button has been pressed.\n                                    e.preventDefault();\n                                    executor(courseid, sections, command, returnurl);\n                                });\n                            });\n                        }\n                    }\n                });\n\n                $(\"#btn_cancel\").on('click', function() {\n                    window.location = $('#returnurl').val();\n                });\n\n            };\n\n// ---------------------------------------------------------------------------------------------------------------------\n            var checkAll = function() {\n                $(\"#btn_checkall\").on('click', function() {\n                    $('input[class=\"section\"]:not(:checked)').click();\n//                    $('input[class=\"section\"]:not(:checked)').each(function() {\n//                        $(this).click();\n//                    });\n                });\n            };\n\n// ---------------------------------------------------------------------------------------------------------------------\n            var uncheckAll = function() {\n                $(\"#btn_uncheckall\").on('click', function() {\n                    $('input[class=\"section\"]:checked').each(function() {\n                        $(this).click();\n                    });\n                });\n            };\n\n// ---------------------------------------------------------------------------------------------------------------------\n            var checkSelection = function() {\n                $(\".is_hiding\").on('click', function(event) {\n                    if (event.altKey) {\n                        $(\".is_hiding\").parent().find('.section').click();\n                    }\n                });\n\n                $(\".tablocation\").on('click', function(event) {\n                    var self = $(this);\n                    if (event.altKey) {\n                        console.log(self.attr('value'));\n                        var theVal = self.attr('value');\n//                        alert(theVal);\n                        $(\".tablocation[value='\" + theVal + \"']\").parent().find('.section').click();\n                    }\n                });\n            };\n\n// ---------------------------------------------------------------------------------------------------------------------\n            var initFunctions = function() {\n                // Load all required functions above\n                execute();\n                checkAll();\n                uncheckAll();\n                checkSelection();\n//                $('.dropdown-toggle').dropdown();\n            };\n\n// ---------------------------------------------------------------------------------------------------------------------\n            $(document).ready(function() {\n                console.log('=================< execute.js >==================');\n                initFunctions();\n\n            });\n        }\n    };\n});"],"file":"execute.min.js"}